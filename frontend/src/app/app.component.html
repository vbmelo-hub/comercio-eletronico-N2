<div class="layout">
  <nav class="navbar">
    <div class="brand">
      <div class="brand-mark">üêæ</div>
      <div>
        <p class="eyebrow">Artemis Pets</p>
        <strong>Loja completa para seu pet</strong>
      </div>
    </div>

    <div class="nav-links">
      <button class="nav-btn" [class.active]="activeTab==='catalog'" (click)="setTab('catalog')">Cat√°logo</button>
      <button class="nav-btn" [class.active]="activeTab==='cart'" (click)="setTab('cart')">Carrinho</button>
      <button class="nav-btn" [class.active]="activeTab==='orders'" (click)="setTab('orders')">Pedidos</button>
      <button class="nav-btn" [class.active]="activeTab==='profile'" (click)="setTab('profile')">Perfil</button>
      <button class="nav-btn" *ngIf="isAdmin" [class.active]="activeTab==='admin'" (click)="setTab('admin')">Admin</button>
    </div>

    <div class="nav-user">
      <span class="pill" *ngIf="user; else guest">{{user?.name}} ¬∑ {{user?.role}}</span>
      <ng-template #guest><span class="pill muted">Visitante</span></ng-template>
      <button class="btn ghost" *ngIf="!user" (click)="setTab('profile')">Entrar</button>
      <button class="btn ghost danger" *ngIf="user" (click)="logout()">Sair</button>
    </div>
  </nav>

  <div class="status" *ngIf="statusMessage">{{statusMessage}}</div>

  <main>
    <!-- CAT√ÅLOGO -->
    <section *ngIf="activeTab==='catalog'" class="panel catalog-panel">
      <div class="panel-head">
        <div>
          <p class="eyebrow">Produtos</p>
          <h2>Cat√°logo premium</h2>
        </div>
        <div class="pill muted">Itens dispon√≠veis: {{products.length}}</div>
      </div>

      <div class="filters-bar">
        <label>
          <span class="muted tiny">Buscar</span>
          <input placeholder="Ra√ß√£o, brinquedo, petisco..." [(ngModel)]="searchTerm" (input)="loadProducts()">
        </label>
        <label>
          <span class="muted tiny">Tipo de pet</span>
          <select [(ngModel)]="petFilter" (change)="loadProducts()">
            <option value="">Todos</option>
            <option value="DOG">C√£es</option>
            <option value="CAT">Gatos</option>
            <option value="ACCESSORY">Acess√≥rios</option>
          </select>
        </label>
        <label>
          <span class="muted tiny">Categoria</span>
          <select [(ngModel)]="categoryFilter" (change)="loadProducts()">
            <option [ngValue]="null">Todas</option>
            <option *ngFor="let c of categories" [ngValue]="c.id">{{c.name}}</option>
          </select>
        </label>
      </div>

      <div class="product-grid">
        <article class="card product" *ngFor="let p of products">
          <img [src]="p.imageUrl" [alt]="p.name">
          <div class="row">
            <span class="pill">{{p.category?.name}} ¬∑ {{p.petType}}</span>
            <span class="pill">‚òÖ {{p.rating}}</span>
          </div>
          <h3>{{p.name}}</h3>
          <p class="muted">{{p.description}}</p>
          <div class="card-footer">
            <span class="price">{{p.price | currency:'BRL':'symbol'}}</span>
            <span class="muted">Estoque: {{p.stock}}</span>
          </div>
          <button class="btn primary cta" (click)="addToCart(p)" title="Clique para adicionar ao carrinho">Adicionar ao carrinho</button>
        </article>
      </div>
    </section>

    <!-- CARRINHO -->
    <section class="panel" *ngIf="activeTab==='cart'">
      <div class="panel-head">
        <div>
          <p class="eyebrow">Checkout</p>
          <h2>Carrinho e pagamento</h2>
        </div>
        <button class="btn ghost" (click)="clearCart()">Esvaziar</button>
      </div>
      <div class="split">
        <div class="card stack">
          <h3>Itens no carrinho</h3>
          <div class="cart-list">
            <div class="cart-row" *ngFor="let item of cartItems">
              <div>
                <strong>{{item.product.name}}</strong>
                <p class="muted">{{item.product.price | currency:'BRL':'symbol'}} ¬∑ Estoque: {{item.product.stock}}</p>
              </div>
              <div class="row">
                <input type="number" min="1" [max]="item.product.stock" [(ngModel)]="item.quantity" (change)="updateQty(item.product.id, item.quantity)" style="width:80px;">
                <button class="btn ghost danger" (click)="removeItem(item.product.id)">Remover</button>
              </div>
            </div>
            <p class="muted" *ngIf="cartItems.length===0">Carrinho vazio.</p>
          </div>
          <div class="row">
            <label style="flex:1;">Cupom
              <input placeholder="BEMVINDO" [(ngModel)]="checkoutForm.coupon">
            </label>
            <button class="btn ghost" (click)="applyCoupon()">Aplicar</button>
          </div>
          <div class="row total-row">
            <span class="muted">Itens: {{cartItems.length}}</span>
            <span class="price">{{ cartTotal | currency:'BRL':'symbol' }}</span>
          </div>
        </div>

        <div class="card stack">
          <h3>Entrega e pagamento</h3>
          <div class="mini-grid">
            <label>Nome<input [(ngModel)]="checkoutForm.name"></label>
            <label>Email<input [(ngModel)]="checkoutForm.email"></label>
          </div>
          <label>Endere√ßo<input [(ngModel)]="checkoutForm.street"></label>
          <div class="mini-grid">
            <label>Cidade<input [(ngModel)]="checkoutForm.city"></label>
            <label>Estado<input [(ngModel)]="checkoutForm.state"></label>
          </div>
          <div class="mini-grid">
            <label>CEP<input [(ngModel)]="checkoutForm.zip"></label>
            <label>Pagamento
              <select [(ngModel)]="checkoutForm.paymentMethod">
                <option value="CREDIT_CARD">Cart√£o</option>
                <option value="PIX">PIX</option>
                <option value="BOLETO">Boleto</option>
              </select>
            </label>
          </div>
          <button class="btn primary full" (click)="checkout()">Finalizar</button>
        </div>
      </div>
    </section>

    <!-- PEDIDOS -->
    <section class="panel" *ngIf="activeTab==='orders'">
      <div class="panel-head">
        <div>
          <p class="eyebrow">Hist√≥rico</p>
          <h2>Pedidos simulados</h2>
        </div>
        <button class="btn ghost" (click)="loadOrders()">Atualizar</button>
      </div>
      <div class="grid">
        <div class="order-card card" *ngFor="let o of orders">
          <div class="row">
            <strong>#{{o.id}}</strong>
            <span class="muted">{{o.createdAt | date:'short'}}</span>
          </div>
          <div class="row">
            <span>{{o.items.length}} itens</span>
            <span class="price">{{o.total | currency:'BRL':'symbol'}}</span>
          </div>
          <div class="muted">Pagamento: {{o.paymentMethod}} ¬∑ Status: {{o.status}}</div>
        </div>
        <p class="muted" *ngIf="orders.length===0">Sem pedidos ainda.</p>
      </div>
    </section>

    <!-- PERFIL -->
    <section class="panel" *ngIf="activeTab==='profile'">
      <div class="panel-head">
        <div>
          <p class="eyebrow">Conta</p>
          <h2>Login, cadastro e pets</h2>
        </div>
      </div>
      <div class="split">
        <div class="card stack">
          <h3>Login</h3>
          <label>Email<input [(ngModel)]="loginForm.email"></label>
          <label>Senha<input type="password" [(ngModel)]="loginForm.password"></label>
          <button class="btn primary full" (click)="login()">Entrar</button>
          <p class="muted">Admin: admin&#64;petshop.com / admin123</p>
        </div>
        <div class="card stack">
          <h3>Novo cadastro</h3>
          <label>Nome<input [(ngModel)]="signupForm.name"></label>
          <label>Email<input [(ngModel)]="signupForm.email"></label>
          <label>Senha<input type="password" [(ngModel)]="signupForm.password"></label>
          <button class="btn ghost full" (click)="signup()">Cadastrar</button>
        </div>
      </div>

      <div class="card stack" *ngIf="user">
        <div class="row">
          <div>
            <p class="eyebrow">Pets</p>
            <h3>{{user?.name}}</h3>
          </div>
        </div>
        <div class="pill-collection">
          <span class="pill" *ngFor="let p of user?.pets">{{p.name}} ¬∑ {{p.age}} ¬∑ {{p.breed}}</span>
        </div>
        <div class="mini-grid">
          <label>Nome<input [(ngModel)]="petForm.name"></label>
          <label>Idade<input [(ngModel)]="petForm.age"></label>
          <label>Ra√ßa<input [(ngModel)]="petForm.breed"></label>
        </div>
        <button class="btn ghost" (click)="addPet()">Adicionar pet</button>
      </div>
    </section>

    <!-- ADMIN -->
    <section class="panel" *ngIf="activeTab==='admin' && isAdmin">
      <div class="panel-head">
        <div>
          <p class="eyebrow">Painel</p>
          <h2>Administra√ß√£o</h2>
        </div>
      </div>
      <div class="card stack">
        <h3>Produto</h3>
        <div class="mini-grid">
          <label>Nome<input [(ngModel)]="adminProduct.name"></label>
          <label>Descri√ß√£o<input [(ngModel)]="adminProduct.description"></label>
          <label>Pre√ßo<input type="number" [(ngModel)]="adminProduct.price"></label>
          <label>Estoque<input type="number" [(ngModel)]="adminProduct.stock"></label>
          <label>Categoria
            <select [(ngModel)]="adminProduct.categoryId">
              <option *ngFor="let c of categories" [ngValue]="c.id">{{c.name}}</option>
            </select>
          </label>
          <label>Tipo pet
            <select [(ngModel)]="adminProduct.petType">
              <option value="DOG">C√£es</option>
              <option value="CAT">Gatos</option>
              <option value="ACCESSORY">Acess√≥rios</option>
            </select>
          </label>
          <label>Imagem<input [(ngModel)]="adminProduct.imageUrl"></label>
        </div>
        <button class="btn primary" (click)="saveProduct()">Salvar produto</button>
      </div>

      <div class="split">
        <div class="card stack">
          <h3>Categorias</h3>
          <div class="row">
            <label style="flex:1;">Nome<input [(ngModel)]="adminCategory.name"></label>
            <label style="flex:1;">Pet
              <select [(ngModel)]="adminCategory.petType">
                <option value="DOG">C√£es</option>
                <option value="CAT">Gatos</option>
                <option value="ACCESSORY">Acess√≥rios</option>
              </select>
            </label>
            <button class="btn ghost" (click)="saveCategory()">Salvar</button>
          </div>
          <div class="pill-collection">
            <span class="pill" *ngFor="let c of categories">
              {{c.name}} ¬∑ {{c.petType}}
              <button class="btn ghost danger" (click)="deleteCategory(c.id)">x</button>
            </span>
          </div>
        </div>

        <div class="card stack">
          <h3>Cupons</h3>
          <div class="row">
            <label style="flex:1;">C√≥digo<input [(ngModel)]="couponForm.code"></label>
            <label style="flex:1;">Desconto %<input type="number" [(ngModel)]="couponForm.discountPercent"></label>
            <label>Ativo
              <select [(ngModel)]="couponForm.active">
                <option [ngValue]="true">Ativo</option>
                <option [ngValue]="false">Pausado</option>
              </select>
            </label>
            <button class="btn ghost" (click)="saveCoupon()">Salvar cupom</button>
            <button class="btn ghost" (click)="loadCoupons()">Atualizar</button>
          </div>
          <div class="pill-collection">
            <span class="pill" *ngFor="let c of coupons">{{c.code}} ¬∑ {{c.discountPercent}}% ¬∑ {{c.active ? 'ativo' : 'off'}}</span>
          </div>
        </div>
      </div>

      <div class="card stack">
        <div class="row">
          <div>
            <p class="eyebrow">Pedidos</p>
            <h3>Pedidos recentes</h3>
          </div>
          <button class="btn ghost" (click)="loadOrders()">Atualizar</button>
        </div>
        <div class="grid">
          <div class="order-card card" *ngFor="let o of orders">
            <div class="row"><strong>#{{o.id}}</strong><span class="muted">{{o.createdAt | date:'short'}}</span></div>
            <div class="row"><span>{{o.items.length}} itens</span><span class="price">{{o.total | currency:'BRL':'symbol'}}</span></div>
            <div class="muted">Cliente: {{o.user?.name}}</div>
          </div>
        </div>
      </div>
    </section>
  </main>
</div>
