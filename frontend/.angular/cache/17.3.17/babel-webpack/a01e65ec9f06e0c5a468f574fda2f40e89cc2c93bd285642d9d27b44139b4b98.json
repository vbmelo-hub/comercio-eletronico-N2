{"ast":null,"code":"import { __decorate } from \"tslib\";\nimport { CommonModule } from '@angular/common';\nimport { Component } from '@angular/core';\nimport { FormsModule } from '@angular/forms';\nlet AppComponent = class AppComponent {\n  constructor(api, state) {\n    this.api = api;\n    this.state = state;\n    this.activeTab = 'catalog';\n    this.categories = [];\n    this.products = [];\n    this.petFilter = '';\n    this.categoryFilter = null;\n    this.searchTerm = '';\n    this.cartItems = [];\n    this.user = null;\n    this.orders = [];\n    this.loginForm = {\n      email: '',\n      password: ''\n    };\n    this.signupForm = {\n      name: '',\n      email: '',\n      password: ''\n    };\n    this.checkoutForm = {\n      name: '',\n      email: '',\n      street: '',\n      city: '',\n      state: '',\n      zip: '',\n      paymentMethod: 'CREDIT_CARD',\n      coupon: ''\n    };\n    this.petForm = {\n      name: '',\n      age: '',\n      breed: ''\n    };\n    this.adminProduct = {\n      id: null,\n      name: '',\n      description: '',\n      price: 0,\n      stock: 0,\n      rating: 4.5,\n      imageUrl: '',\n      petType: 'DOG',\n      categoryId: null\n    };\n    this.adminCategory = {\n      name: '',\n      petType: 'DOG'\n    };\n    this.couponForm = {\n      code: '',\n      discountPercent: 10,\n      active: true\n    };\n    this.coupons = [];\n    this.statusMessage = '';\n  }\n  ngOnInit() {\n    this.state.cart$.subscribe(c => this.cartItems = c.items);\n    this.state.user$.subscribe(u => {\n      this.user = u;\n      if (u) {\n        this.loadOrders();\n        this.api.setToken(this.state.token);\n      }\n    });\n    this.loadCategories();\n    this.loadProducts();\n    this.refreshUser();\n  }\n  setTab(tab) {\n    this.activeTab = tab;\n  }\n  refreshUser() {\n    this.api.me().subscribe(user => {\n      if (user) {\n        this.user = user;\n        this.state.user$.next(user);\n        this.api.setToken(this.state.token);\n      }\n    });\n  }\n  loadCategories() {\n    this.api.getCategories().subscribe(data => this.categories = data);\n  }\n  loadProducts() {\n    this.api.getProducts(this.categoryFilter ?? undefined, this.petFilter || undefined, this.searchTerm || undefined).subscribe(data => {\n      this.products = data;\n    });\n  }\n  addToCart(product) {\n    this.state.addToCart(product, 1);\n    this.statusMessage = `${product.name} adicionado ao carrinho`;\n  }\n  updateQty(productId, qty) {\n    this.state.updateQty(productId, qty);\n  }\n  removeItem(productId) {\n    this.state.removeFromCart(productId);\n  }\n  clearCart() {\n    this.state.clearCart();\n  }\n  applyCoupon() {\n    this.state.setCoupon(this.checkoutForm.coupon || undefined);\n  }\n  login() {\n    this.api.login(this.loginForm.email, this.loginForm.password).subscribe(res => {\n      this.state.setUserAuth(res);\n      this.refreshUser();\n      this.loadOrders();\n      this.statusMessage = 'Login realizado';\n      this.activeTab = 'catalog';\n    });\n  }\n  signup() {\n    this.api.signup(this.signupForm.name, this.signupForm.email, this.signupForm.password).subscribe(res => {\n      this.state.setUserAuth(res);\n      this.refreshUser();\n      this.statusMessage = 'Conta criada';\n    });\n  }\n  logout() {\n    this.state.logout();\n    this.orders = [];\n    this.activeTab = 'catalog';\n  }\n  loadOrders() {\n    this.api.listOrders().subscribe(data => this.orders = data);\n  }\n  checkout() {\n    if (!this.user) {\n      this.statusMessage = 'Entre para finalizar';\n      this.activeTab = 'profile';\n      return;\n    }\n    const items = this.cartItems.map(i => ({\n      productId: i.product.id,\n      quantity: i.quantity\n    }));\n    const payload = {\n      items,\n      couponCode: this.checkoutForm.coupon || undefined,\n      paymentMethod: this.checkoutForm.paymentMethod,\n      name: this.checkoutForm.name,\n      email: this.checkoutForm.email,\n      street: this.checkoutForm.street,\n      city: this.checkoutForm.city,\n      state: this.checkoutForm.state,\n      zip: this.checkoutForm.zip\n    };\n    this.api.createOrder(payload).subscribe(order => {\n      this.statusMessage = `Pedido ${order.id} confirmado`;\n      this.state.clearCart();\n      this.loadOrders();\n      this.loadProducts();\n      this.activeTab = 'orders';\n    });\n  }\n  addPet() {\n    if (!this.user) return;\n    this.api.addPet(this.petForm.name, this.petForm.age, this.petForm.breed).subscribe(() => {\n      this.statusMessage = 'Pet adicionado';\n      this.petForm = {\n        name: '',\n        age: '',\n        breed: ''\n      };\n      this.refreshUser();\n    });\n  }\n  // Admin\n  loadCoupons() {\n    this.api.adminListCoupons().subscribe(c => this.coupons = c);\n  }\n  saveProduct() {\n    this.api.adminSaveProduct(this.adminProduct).subscribe(() => {\n      this.statusMessage = 'Produto salvo';\n      this.adminProduct = {\n        id: null,\n        name: '',\n        description: '',\n        price: 0,\n        stock: 0,\n        rating: 4.5,\n        imageUrl: '',\n        petType: 'DOG',\n        categoryId: null\n      };\n      this.loadProducts();\n    });\n  }\n  deleteProduct(id) {\n    this.api.adminDeleteProduct(id).subscribe(() => {\n      this.statusMessage = 'Produto removido';\n      this.loadProducts();\n    });\n  }\n  saveCategory() {\n    this.api.adminCreateCategory(this.adminCategory).subscribe(() => {\n      this.statusMessage = 'Categoria salva';\n      this.adminCategory = {\n        name: '',\n        petType: 'DOG'\n      };\n      this.loadCategories();\n    });\n  }\n  deleteCategory(id) {\n    this.api.adminDeleteCategory(id).subscribe(() => {\n      this.statusMessage = 'Categoria removida';\n      this.loadCategories();\n    });\n  }\n  saveCoupon() {\n    this.api.adminSaveCoupon(this.couponForm).subscribe(() => {\n      this.statusMessage = 'Cupom salvo';\n      this.couponForm = {\n        code: '',\n        discountPercent: 10,\n        active: true\n      };\n      this.loadCoupons();\n    });\n  }\n};\nAppComponent = __decorate([Component({\n  selector: 'app-root',\n  standalone: true,\n  imports: [CommonModule, FormsModule],\n  templateUrl: './app.component.html',\n  styleUrls: ['./app.component.css']\n})], AppComponent);\nexport { AppComponent };","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}