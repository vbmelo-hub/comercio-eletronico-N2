{"ast":null,"code":"import { BehaviorSubject } from 'rxjs';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"./api.service\";\nexport let StateService = /*#__PURE__*/(() => {\n  class StateService {\n    constructor(api) {\n      this.api = api;\n      this.user$ = new BehaviorSubject(null);\n      this.cart$ = new BehaviorSubject({\n        items: []\n      });\n      this.orders$ = new BehaviorSubject([]);\n      this.token = null;\n      const storedToken = localStorage.getItem('petshop-token');\n      const storedCart = localStorage.getItem('petshop-cart');\n      if (storedToken) {\n        this.setToken(storedToken);\n        this.api.me().subscribe(user => this.user$.next(user));\n      }\n      if (storedCart) {\n        this.cart$.next(JSON.parse(storedCart));\n      }\n    }\n    persistCart() {\n      localStorage.setItem('petshop-cart', JSON.stringify(this.cart$.value));\n    }\n    setToken(token) {\n      this.token = token;\n      this.api.setToken(token);\n      if (token) localStorage.setItem('petshop-token', token);else localStorage.removeItem('petshop-token');\n    }\n    setUserAuth(auth) {\n      this.setToken(auth.token);\n      this.user$.next({\n        id: auth.userId,\n        name: auth.name,\n        email: auth.email,\n        role: auth.role,\n        pets: []\n      });\n    }\n    logout() {\n      this.setToken(null);\n      this.user$.next(null);\n    }\n    addToCart(product, quantity = 1) {\n      const cart = this.cart$.value;\n      const existing = cart.items.find(i => i.product.id === product.id);\n      if (existing) {\n        existing.quantity = Math.min(existing.quantity + quantity, product.stock);\n      } else {\n        cart.items.push({\n          product,\n          quantity\n        });\n      }\n      this.cart$.next({\n        ...cart\n      });\n      this.persistCart();\n    }\n    updateQty(productId, quantity) {\n      const cart = this.cart$.value;\n      cart.items = cart.items.map(i => i.product.id === productId ? {\n        ...i,\n        quantity\n      } : i).filter(i => i.quantity > 0);\n      this.cart$.next({\n        ...cart\n      });\n      this.persistCart();\n    }\n    removeFromCart(productId) {\n      const cart = this.cart$.value;\n      cart.items = cart.items.filter(i => i.product.id !== productId);\n      this.cart$.next({\n        ...cart\n      });\n      this.persistCart();\n    }\n    clearCart() {\n      this.cart$.next({\n        items: []\n      });\n      this.persistCart();\n    }\n    setCoupon(code) {\n      const cart = this.cart$.value;\n      cart.couponCode = code;\n      this.cart$.next({\n        ...cart\n      });\n      this.persistCart();\n    }\n    static {\n      this.ɵfac = function StateService_Factory(t) {\n        return new (t || StateService)(i0.ɵɵinject(i1.ApiService));\n      };\n    }\n    static {\n      this.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n        token: StateService,\n        factory: StateService.ɵfac,\n        providedIn: 'root'\n      });\n    }\n  }\n  return StateService;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}